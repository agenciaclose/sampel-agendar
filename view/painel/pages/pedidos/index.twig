{% extends "layout/layoutPanel.twig" %}

{% block title %} Pedidos {% endblock %}

{% block body %}

    <!-- BEGIN: Content-->
    <div class="app-content content ">
        <div class="content-overlay"></div>
        <div class="header-navbar-shadow"></div>
        <div class="content-wrapper">
            <div class="content-header row"></div>
            <div class="content-body">

				<div class="card">
					<div class="card-body">

						<form action="javascript:void(0)" id="novo_pedido" method="POST">

							<div class="d-flex justify-content-between flex-wrap align-items-end">
								<div class="mb-1 flex-fill w-md-100">
									<label for="tipo_evento" class="form-label">Víncular a um Tipo de Evento</label>
									<select class="form-control text-uppercase" name="tipo_evento" id="tipo_evento" required="required">
										<option>Selecione</option>
										<option value="visitas">Visitas</option>
										<option value="palestras">Palestras</option>
										<option value="eventos">Eventos e Feitas</option>
										<option value="extra">Pedido Extra</option>
									</select>
								</div>
								<div class="mb-1 flex-fill mx-md-3 w-md-100">
									<label for="id_evento" class="form-label id_evento">Selecione o Evento</label>
									<select class="form-control select2 id_evento_select text-uppercase" name="id_evento">
										<option>Selecione</option>
									</select>
								</div>
								<div class="mb-1 flex-fill me-md-3 w-md-100">
									<label for="descricao_pedido" class="form-label">Informações sobre o Pedido</label>
									<input class="form-control text-uppercase" name="descricao_pedido" id="descricao_pedido" placeholder="Descrição sobre o Pedido">
								</div>
								<div class="mb-1">
									<button type="submit" class="btn btn-primary" id="salvar">ENVIAR PEDIDO</button>
								</div>
							</div>

							<div class="table-responsive lista_produtos"> 
								<div class="table-wrapper">
									<table id="produtos" class="table table-striped table-hover">
										<thead>
											<tr>
												<th></th>
												<th class="filter-column"><i class="fa-regular fa-magnifying-glass"></i> Nome Produto</th>
												<th>Codigo</th>
												<th class="text-center">Embalagem</th>
												<th class="text-center">Unidades</th>
												<th class="text-center">Valor Unit (R$)</th>
												<th class="text-center" width="50">Quantidade</th>
												<th class="text-center" width="50">Qtd Total</th>
												<th class="text-center">Valor Total (R$)</th>
												<th class="text-center" width="75"><span>Estoque</span></th>
											</tr>
										</thead>
										<tbody>
											{% for produto in produtos %}
												<tr>
													<td class="p-0">
														<input type="hidden" name="idProduto[]" value="{{ produto.id }}">
														{% if produto.imagem != '' %}
															<a href="{{ produto.imagem }}" class="img"><img src="{{ produto.imagem }}" width="50" class="img-fluid"></a>
														{% else %}                                                            
															<img src="{{ DOMAIN }}/view/painel/src/images/produtos/produto-placeholder-small.png" width="50" class="img-fluid">
														{% endif %}
													</td>
													<td>{{ produto.nome }}</td>
													<td>{{ produto.codigo }}</td>
													<td class="text-center">{{ produto.embalagem }} / {{ produto.quantidade }}</td>
													<td class="text-center">{{ produto.unidades }}</td>
													<td class="text-center">R$ {{ produto.preco|number_format(2, ',', '.') }}</td>
													<td class="text-center" width="50">
														{% if produto.quantidade > 0 %}
															<div data-bs-toggle="tooltip" data-bs-placement="top" data-bs-html="true" data-bs-title="Qtd. disponível atualmente: <b>{{ produto.quantidade > 0 ? produto.quantidade : 0 }}</b>">
																<input type="number" name="quantidade[]" data-numspin
																data-valor="{{ produto.preco|number_format(2, ',', '.') }}"
																data-item="{{ produto.id }}"
																data-validation="0"
																data-unidades="{{ produto.unidades }}"
																class="{{ produto.quantidade <= 0 ? 'disabled' }} form-control text-center quantidade-{{ produto.id }}" 
																min="0" max="{{ produto.quantidade > 0 ? produto.quantidade : 0 }}" value="0">
															</div>
														{% else %}
															<input type="hidden" name="quantidade[]"
															class="{{ produto.quantidade <= 0 ? 'disabled' }} form-control text-center quantidade-{{ produto.id }}" 
															min="0" max="{{ produto.quantidade > 0 ? produto.quantidade : 0 }}" value="0">
															<div class="alert alert-danger m-0" role="alert"><small>Indisponível</small></div>
														{% endif %}
													</td>
													<td class="text-center" width="50">
														<span class="text-success" id="qtd-total-{{ produto.id }}">0</span>
														<input type="hidden" name="qt-total[]" id="qtd-total-value-{{ produto.id }}">
													</td>
													<td class="text-center text-success">
														R$ <span id="itemTotal-{{ produto.id }}" class="valorItemTotal">0,00</span>
														<input type="hidden" name="valor-total[]" id="valor-itemTotal-{{ produto.id }}">
													</td>
													<td id="cota-{{ produto.id }}" class="text-center text-white {{ produto.estoque <= 0 ? 'bg-danger' : 'bg-success' }}"><span class="itemMax-{{ produto.id }}">{{ produto.estoque > 0 ? produto.estoque : 0 }}</span> </td>
												</tr>
											{% endfor %}

										</tbody>
									</table>
								</div>
							</div>

						</form>

					</div>
				</div>

			</div>
		</div>
	</div>

<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="{{ DOMAIN }}/view/painel/src/vendors/numspin/js/input-numspin.js"></script>
<link href="{{ DOMAIN }}/view/painel/src/vendors/numspin/css/input-numspin.min.css" rel="stylesheet" type="text/css" />
<script src="{{ DOMAIN }}/view/painel/src/js/scripts/pages/pedidos.js"></script>
{% endblock %}