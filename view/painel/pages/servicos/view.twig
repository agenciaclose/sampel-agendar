{% extends "layout/layoutPanel.twig" %}

{% block title %}56 minutos - Venda{% endblock %}

{% block body %}

    <!-- BEGIN: Content-->
    <div class="app-content content ">
        <div class="content-overlay"></div>
        <div class="header-navbar-shadow"></div>
        <div class="content-wrapper">
            <div class="content-header row">
            </div>
            <div class="content-body">
                <!-- Dashboard Ecommerce Starts -->
                <section id="dashboard-ecommerce">

                    <div class="row">

						<div class="col-md-9">

							<div class="clearfix"></div>


							<div class="card">

								<div class="card-body">

									<div class=" d-flex justify-content-between mb-1">
										<h4 class="m-0">Detalhes do Pedido #{{ venda.id }}</h4>
										<div><b>Status do Pedido:</b> {{ venda.status|payStatus|raw }} / {{ ( venda.situacao == 'Pendente') ? '<span class="badge badge-pill badge-light-warning">Pendente</span>' : '<span class="badge badge-pill badge-light-success">Concluído</span>' }}</div>
									</div>
									<div class=" d-flex justify-content-between">
										<h6 class="text-primary">Codigo: {{ venda.external_reference }}</h6>
										<h6><i class="fas fa-calendar-alt"></i> {{ venda.created|date("d-m-Y H:i:s", "America/Sao_Paulo") }}</h6>
									</div>

									<div class="row">

										<div class="col-md-4 col-sm-12 mt-3">
											<label class=""><b>Detalhes do Pedido</b></label>
											<div class="border-bottom p-1 d-flex justify-content-between align-items-center">
												Subtotal:
												<span>R$ {{ venda.total|number_format(2, ',', '.') }}</span>
											</div>
											<div class="border-bottom p-1 d-flex justify-content-between align-items-center">
												Frete:
												<span>Grátis</span>
											</div>
											<div class="border-bottom p-1 d-flex justify-content-between align-items-center text-primary fs-5">
												<b>Total:</b>
												<span><b>R$ {{ venda.total|number_format(2, ',', '.') }}</b></span>
											</div>

											<div class="border-bottom p-1 d-flex justify-content-between align-items-center">
												<b>Metodo de pagamento:</b>
												<span><b>{{ venda.tipo_pg }}</b></span>
											</div>
										</div>

										<div class="col-md-4 col-sm-12 mt-3">
											<label><b>Detalhes do Usuário</b></label>
											<div class="border-bottom p-1 d-flex justify-content-between align-items-center">
												Nome:
												<span class="">{{ venda.c_nome }}</span>
											</div>
											<div class="border-bottom p-1 d-flex justify-content-between align-items-center">
												CPF:
												<span class="">{{ venda.c_cpf }}</span>
											</div>
											<div class="border-bottom p-1 d-flex justify-content-between align-items-center">
												Email:
												<span class="">{{ venda.c_email }}</span>
											</div>
											<div class="border-bottom p-1 d-flex justify-content-between align-items-center">
												Telefone:
												<span class="">{{ venda.c_telefone }}</span>
											</div>
										</div>

										<div class="col-md-4 col-sm-12 mt-3">
											<label><b>Endereço do Cliente</b></label>
											<div class="border-bottom p-1 d-flex justify-content-between align-items-center">
												Rua:
												<span>{{ venda.c_endereco }}, {{ venda.c_numero }}</span>
											</div>
											<div class="border-bottom p-1 d-flex justify-content-between align-items-center">
												Bairro:
												<span>{{ venda.c_bairro }}</span>
											</div>
											<div class="border-bottom p-1 d-flex justify-content-between align-items-center">
												Complemento:
												<span>{{ venda.c_complemento }}</span>
											</div>
											<div class="border-bottom p-1 d-flex justify-content-between align-items-center">
												Cidade / Estado:
												<span>{{ venda.c_cidade }} - {{ venda.c_estado }}</span>
											</div>
										</div>

									</div>

								</div>

							</div>

							<div class="card">

								<div class="card-header card-header-post">
									<div class=""><h5 class="m-0">Informações do Agendamento</h5></div>
								</div>

								<div class="card-body">

									<div class="row">
										<div class="col-md-6">
											<h5 class="mb-2 border-bottom d-block">Serviço</h5>

											<div  class="d-flex justify-content-start flex-wrap">
												<div class="me-1"><img width="75" height="75" src="{{ DOMAIN }}/uploads/{{ venda.imagem }}"  alt="" title=""></div>
												<div class="flex-grow-1">
													<div class="border-bottom pb-1 w-100">
														<div class="d-flex justify-content-between">
															<div><b>Nome:</b></div>
															<div>{{ venda.itemTitle }}</div>
														</div>
													</div>
													<div class="border-bottom pt-1">
														<div class="d-flex justify-content-between">
															<div><b>Preço:</b></div>
															<div>R$ {{ venda.total|number_format(2, ',', '.')  }}</div>
														</div>
													</div>
												</div>
											</div>
										</div>
										<div class="col-md-6">
											<h5 class="mb-2 border-bottom d-block">Datas e Horários</h5>
											{% for horario in horarios %}
											<div class="border-bottom pb-1 w-100">
												<div class="d-flex justify-content-between">
													<div><b><i class="fa-solid fa-calendar-days me-1"></i> {{ horario.dia_agendamento|date("d-m-Y", "America/Sao_Paulo") }}:</b></div>
													<div><i class="fa-solid fa-clock me-1"></i>{{ horario.horario_agendamento }}</div>
												</div>
											</div>
											{% endfor %}
										</div>
									</div>

								</div>

							</div>
						</div>

						<div class="col-md-3">

							<div class="card">
								<div class="card-header card-header-post">
									<div class=""><b>Confirmar como Concluído</b></div>
								</div>
								<div class="card-body">
									<div>
										<div><i class="fa-solid fa-circle-exclamation"></i> Poderá marcar como concluído 24h após o último horário do agendamento e passado o período de contestação. O valor do agendamento só ficará disponível em sua carteira após marcar como concluído.</div>
										{% if horarios[0].dia_agendamento|date_modify("+1 day")|date("Y-m-d") <= "now"|date('Y-m-d') and venda.situacao == 'Pendente' %}
											<div class="d-block w-100 text-center pt-1 mt-1 border-top"><a href="javascript:void(0);" data-item="{{ venda.id }}" class="btn btn-primary btn-sm acAction"><i class="fa-solid fa-check-double"></i> MARCAR COMO CONCLUÍDO</a></div>
										{% elseif venda.situacao == 'Concluido' %}
											<div class="d-block w-100 text-center pt-1 mt-1 border-top"><a href="javascript:void(0);" class="btn btn-success btn-sm"><i class="fa-solid fa-check-double"></i> JÁ CONCLUÍDO</a></div>
										{% else %}
											<div class="d-block w-100 text-center pt-1 mt-1 border-top"><a href="javascript:void(0);" class="btn btn-warning btn-sm disabled" disabled="disabled"><i class="fa-solid fa-check-double"></i> INDISPONÍVEL</a></div>
										{% endif %}
									</div>
								</div>
							</div>

							<div class="card">
								<div class="card-header card-header-post">
									<div class=""><b>Link para o agendamento</b></div>
								</div>
								<div class="card-body">
									<div class="d-flex justify-content-between">
										{% if venda.link_consultor != '' %}
										<div>
											<a href="{{ venda.link_consultor }}" target="_blank"><i class="fa-solid fa-link"></i> ACESSAR LINK</a>
										</div>
										{% endif %}
										<a data-bs-toggle="modal-remote" data-remote="{{ DOMAIN }}/view/painel/src/modal/agendamentos/link.php?id={{ venda.id }}" data-bs-target="#add_link" href="javascript:void(0);" class="btn btn-primary btn-sm"><i class="fa-solid fa-link"></i> EDITAR</a>
									</div>
								</div>
							</div>

							<form method="POST" action="">
								<div class="card">

									<div class="card-header card-header-post">
										<div class=""><b>Notas do Pedido</b></div>
									</div>

									<div class="card-body">

										<ul class="order_notes">
											{% for nota in notas %}
											<li class="note">
												<div class="note_content {{ nota.tipo }}">
													<p class="mb-0">{{ nota.nota }}</p>
												</div>
												<p class="meta mt-2">
													<abbr class="exact-date" title="{{ nota.data|date("d-m-Y H:i:s", "America/Sao_Paulo") }}">{{ nota.data|date("d-m-Y H:i:s", "America/Sao_Paulo") }}</abbr>
													<!-- <a href="javascript:void(0);" data-id="" class="delete_note" role="button">Apagar nota</a> -->
												</p>
											</li>
											{% endfor %}
										</ul>

										<div class="border-top pt-2 mt-2">
											<div><label for="add_order_note">Adicionar nota <span class="ml-4" data-toggle="tooltip" data-placement="top" title="Adicionar uma nota para sua referência ou adicionar uma nota de cliente (o usuário será notificado)."><i class="fas fa-exclamation-circle"></i></span></label></div>
											<textarea type="text" name="nota_texto" id="add_order_note" class="form-control" cols="20" rows="5"></textarea>
										</div>

									</div>

									<div class="card-footer py-2">
										<div class="d-flex justify-content-between align-items-center">
											<div>
												<select class="form-control form-control-sm" name="tipo_nota">
													<option value="privada">Nota privada</option>
													<option value="cliente">Nota para o cliente</option>
												</select>
											</div>
											<span>
												<input type="hidden" name="pedido" value="<?php echo $pedido['id'] ?>">
												<input type="hidden" name="action" value="notas">
												<button type="submit" class="btn btn-primary btn-sm">Adicionar</button>
											</span>
										</div>
									</div>

								</div>
							</form>

						</div>

					</div>

                </section>

            </div>
        </div>
    </div>

    <div class="modal fade" id="add_link" tabindex="-1" role="dialog">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-body p-0"></div>
			</div>
		</div>
	</div>
{% endblock %}